server {
    listen 80 default_server;
    listen [::]:80 default_server;

    absolute_redirect off;

    # Redirect root to CGI HTML
    location = / {
        return 301 /munin/;
    }

    # Static files used by Munin UI
    location /munin/static/ {
        alias /etc/munin/static/;
    }

    # Munin HTML via FastCGI (munin-cgi-html)
    location /munin/ {
        fastcgi_split_path_info ^(/munin)(.*);
        fastcgi_param PATH_INFO $fastcgi_path_info;
        fastcgi_pass unix:/var/run/munin/fastcgi-html.sock;
        include fastcgi_params;
    }

    # Munin graphs via FastCGI (munin-cgi-graph)
    location ^~ /munin-cgi/munin-cgi-graph/ {
        fastcgi_split_path_info ^(/munin-cgi/munin-cgi-graph)(.*);
        fastcgi_param PATH_INFO $fastcgi_path_info;
        fastcgi_pass unix:/var/run/munin/fastcgi-graph.sock;
        include fastcgi_params;
    }
}
